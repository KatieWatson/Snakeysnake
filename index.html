<html>
  <body style="font-family: 'Courier New', Courier, monospace">
    <div
      id="board"
      style="
        background-color: lightslategray;
        display: block;
        position: relative;
      "
    >
      <div
        id="food"
        style="
          visibility: hidden;
          display: block;
          position: absolute;
          background-color: black;
          height: 8px;
          width: 8px;
          z-index: 1000;
        "
      ></div>
    </div>
    <span>Score:</span>
    <span id="score">0</span>
    <span>Best:</span>
    <span id="best">0</span>
    <div id="overlay" style="">
      <div
        style="
          width: 100%;
          height: 100%;
          position: absolute;
          background-color: black;
          opacity: 80%;
          display: block;
          top: 0;
          left: 0;
          z-index: 100000000;
          align-items: center;
        "
      ></div>

      <div
        style="
          background-color: white;
          z-index: 100000001;
          position: absolute;
          top: 30px;
          left: 30px;
          border-radius: 90px;
          display: flex;
        "
      >
        <img
          src="disco_slug.png"
          width="300px"
          style="padding: 5px; border-radius: 90px; display: flex"
        />
        <div
          style="
            justify-content: center;
            min-width: 200px;
            display: flex;
            align-items: center;
          "
        >
          <div>
            <button
              onclick="startGame()"
              style="
                height: 30px;
                width: 100px;
                border-color: #584963;
                border-radius: 30px;
                box-shadow: none;
                color: white;
                background-color: #5a3973;
                margin-bottom: 10px;
              "
            >
              START</button
            ><br />
            <input
              id="discoToggle"
              checked
              onclick="toggleDisco()"
              type="checkbox"
            />
            Disco Mode
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    discoMode = true;
    score = 0;
    best = 0;
    arenaWidth = 75;
    arenaHeight = 40;
    blockSize = Math.floor(
      Math.min((window.innerWidth - 20) / 75, (window.innerHeight - 20) / 40)
    );

    centerX = ~~(arenaWidth / 2);
    centerY = ~~(arenaHeight / 2);
    snake = [
      [centerX, centerY - 1],
      [centerX, centerY],
      [centerX, centerY + 1],
    ];
    foodPosition = [];
    turnQueue = [];
    border = [];
    snakeObjects = [];

    gradientCount = 10;
    colors = makeColorSequence(gradientCount);
    currentColor = 0;
    direction = "u";
    growCount = 0;

    activeGame = false;
    moving = false;
    step = setInterval(function () {
      moveSnake();
    }, 75);

    board = document.getElementById("board");
    board.style.width = `${arenaWidth * blockSize}`;
    board.style.height = `${arenaHeight * blockSize}`;

    overlay = document.getElementById("overlay");

    z = 3;

    function listIncludesPoint(pointsList, point) {
      for (var i = 0; i < pointsList.length; i++) {
        if (pointsList[i][0] == point[0] && pointsList[i][1] == point[1]) {
          return true;
        }
      }
      return false;
    }

    function drawSquare(color, position, isBorder) {
      square = document.createElement("div");
      board.appendChild(square);
      square.style.width = isBorder ? `${blockSize + 6}` : `${blockSize}`;
      square.style.height = isBorder ? `${blockSize + 6}` : `${blockSize}`;
      square.style.backgroundColor = color;
      square.style.display = "block";
      square.style.position = "absolute";
      square.style.top = isBorder
        ? `${position[1] * blockSize - 3}`
        : `${position[1] * blockSize}`;
      square.style.left = isBorder
        ? `${position[0] * blockSize - 3}`
        : `${position[0] * blockSize}`;
      square.style.zIndex = `${z}`;
      return square;
    }

    function moveSquare(id, position) {
      square = document.getElementById(id);
      console.log(square);
      console.log(id);
      square.style.width = `${blockSize}`;
      square.style.height = `${blockSize}`;
      square.style.visibility = "visible";
      square.style.top = `${position[1] * blockSize}`;
      square.style.left = `${position[0] * blockSize}`;
      square.style.zIndex = `${z}`;
      return square;
    }

    function setFood() {
      x = ~~(Math.random() * arenaWidth);
      y = ~~(Math.random() * arenaHeight);
      while (listIncludesPoint(snake, [x, y])) {
        x = ~~(Math.random() * arenaWidth);
        y = ~~(Math.random() * arenaHeight);
      }
      console.log(`Food set at ${x}, ${y}`);
      foodPosition = [x, y];
      moveSquare("food", foodPosition);
    }

    function drawWholeSnake() {
      for (var i = 0; i < snake.length; i++) {
        segmentBorder = drawSquare("white", snake[i], discoMode);
        border.push(segmentBorder);
      }
      if (discoMode) {
        for (var i = 0; i < snake.length; i++) {
          snakeSegment = drawSquare(colors[currentColor], snake[i], false);
          snakeObjects.push(snakeSegment);
        }
      }
      z++;
    }

    function makeColorSequence(gradientCount) {
      hues = [0, 30, 57, 100, 200, 270, 290];
      finalHues = [];
      darker = true;
      for (var i = 0; i < hues.length; i++) {
        for (var j = 1; j <= gradientCount; j++) {
          // 85 - 45
          if (darker) {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${85 - j * ~~(40 / gradientCount)}%)`
            );
          } else {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${45 + j * ~~(40 / gradientCount)}%)`
            );
          }
        }
        darker = !darker;
      }
      for (var i = 0; i < hues.length; i++) {
        for (var j = 1; j <= gradientCount; j++) {
          // 85 - 45
          if (darker) {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${85 - j * ~~(40 / gradientCount)}%)`
            );
          } else {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${45 + j * ~~(40 / gradientCount)}%)`
            );
          }
        }
        darker = !darker;
      }
      return finalHues;
    }

    function moveSnake() {
      if (!moving || !activeGame) {
        return;
      }
      if (turnQueue.length > 0) {
        changeDirection(turnQueue[turnQueue.length - 1]);
        turnQueue.pop();
      }
      switch (direction) {
        case "u":
          snake = [[snake[0][0], snake[0][1] - 1]].concat(snake);
          break;
        case "d":
          snake = [[snake[0][0], snake[0][1] + 1]].concat(snake);
          break;
        case "l":
          snake = [[snake[0][0] - 1, snake[0][1]]].concat(snake);
          break;
        case "r":
          snake = [[snake[0][0] + 1, snake[0][1]]].concat(snake);
          break;
      }

      // Check whether the snake got itself or hit a wall.
      if (
        listIncludesPoint(snake.slice(1), snake[0]) ||
        snake[0][0] < 0 ||
        snake[0][0] > arenaWidth - 1 ||
        snake[0][1] < 0 ||
        snake[0][1] > arenaHeight - 1
      ) {
        endScreen();
        return;
      }

      // Check whether the snake got the food
      if (snake[0][0] == foodPosition[0] && snake[0][1] == foodPosition[1]) {
        growCount += 3;
        score += 10;
        document.getElementById("score").innerText = score;
        if (score > best) {
          best = score;
          document.getElementById("best").innerText = best;
        }

        setFood();
      }
      border = [drawSquare("white", snake[0], discoMode)].concat(border);
      if (discoMode) {
        snakeObjects = [
          drawSquare(colors[currentColor], snake[0], false),
        ].concat(snakeObjects);
        currentColor++;
      }
      // Delete the tail if not growing.1
      if (growCount > 0) {
        growCount--;
      } else {
        snake.pop();
        board.removeChild(border[border.length - 1]);
        border.pop();
        snakeObjects.pop();
      }
      for (var i = 0; i < border.length; i++) {
        border[i].style.zIndex = z;
      }
      z++;
      for (var i = 0; i < snakeObjects.length; i++) {
        snakeObjects[i].style.zIndex = z;
        snakeObjects[i].style.backgroundColor = colors[currentColor];
      }
      currentColor++;
      if (currentColor >= colors.length) {
        currentColor = 0;
      }
      z++;
    }

    document.addEventListener("keydown", queueTurn);

    function queueTurn(e) {
      if (e.code == "Space") {
        e.preventDefault();
        if (!activeGame) {
          startGame();
          return;
        }
        moving = !moving;
      }
      if (!moving) {
        return;
      }
      if (
        e.code == "ArrowUp" ||
        e.code == "ArrowDown" ||
        e.code == "ArrowLeft" ||
        e.code == "ArrowRight"
      ) {
        turnQueue = [e.code].concat(turnQueue);
      }
    }

    function changeDirection(code) {
      switch (code) {
        case "ArrowUp":
          if (direction != "d") {
            direction = "u";
          }
          break;
        case "ArrowDown":
          if (direction != "u") {
            direction = "d";
          }
          break;
        case "ArrowLeft":
          if (direction != "r") {
            direction = "l";
          }
          break;
        case "ArrowRight":
          if (direction != "l") {
            direction = "r";
          }
          break;
      }
    }

    function startGame() {
      score = 0;
      document.getElementById("score").innerText = score;
      overlay.style.visibility = "hidden";
      foodPosition = [];
      z = 10;
      turnQueue = [];
      border = [];
      snakeObjects = [];
      board.innerHTML = "";
      snake = [
        [centerX, centerY - 1],
        [centerX, centerY],
        [centerX, centerY + 1],
      ];

      drawWholeSnake();
      direction = "u";
      growCount = 0;
      moving = true;
      activeGame = true;
      drawSquare("black", [0, 0], false).id = "food";
      setFood();
    }

    function endScreen() {
      overlay.style.visibility = "visible";
      moving = false;
      activeGame = false;
    }

    function toggleDisco() {
      discoMode = !discoMode;
      document.getElementById("discoToggle").checked = discoMode;
    }
  </script>
</html>
