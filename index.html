<html>
  <head>
    <title>Disco Jerry's Snakey Snake</title>
    <link rel="icon" type="image/png" href="favicon.png" />
  </head>
  <body
    style="
      font-family: 'Courier New', Courier, monospace;
      background-color: #261736;
      color: #e0dae7;
    "
  >
    <div
      style="display: flex; padding: 10px; font-size: 30px; align-items: center"
    >
      <img
        src="lil_slug.png"
        style="padding-right: 5px; width: 50px; height: fit-content"
      />
      DISCO JERRY'S SNAKEY SNAKE GAME
    </div>
    <div style="width: fit-content; margin-inline: auto">
      <div
        id="board"
        style="
          border: #e0dae7;
          border-width: 3px;
          border-style: solid;
          background-color: lightslategray;
          display: block;
          position: relative;
        "
      >
        <div
          id="food"
          style="
            visibility: hidden;
            display: block;
            position: absolute;
            background-color: black;
            height: 8px;
            width: 8px;
            z-index: 1000;
          "
        ></div>
      </div>
      <span>Score:</span>
      <span id="score">0</span>
      <span id="bestScore" style="margin-left: 10px">
        <span>Best:</span>
        <span id="best">0</span>
      </span>
      <span id="bestBanner" style="margin-left: 10px; display: none"
        ><span id="b">B</span>
        <span id="e">E</span>
        <span id="s">S</span>
        <span id="t">T</span></span
      >
    </div>
    <div id="start-screen-overlay" style="color: black">
      <div
        style="
          width: 100%;
          height: 100%;
          position: absolute;
          background-color: black;
          opacity: 80%;
          display: block;
          top: 0;
          left: 0;
          z-index: 100000000;
          align-items: center;
        "
      ></div>

      <div
        style="
          background-color: white;
          z-index: 100000001;
          position: absolute;
          top: 15%;
          border-radius: 90px;
          display: flex;
          padding: 5px;
          left: 0;
          right: 0;
          margin-inline: auto;
          width: fit-content;
        "
      >
        <img
          id="discoSlug"
          src="disco_slug.png"
          style="
            width: 300px;
            height: 300px;
            border-radius: 90px;
            display: flex;
          "
        />
        <img
          id="sadSlug"
          src="sad_slug.png"
          style="border-radius: 90px; display: flex; height: 0; width: 0"
        />
        <div
          style="
            justify-content: center;
            min-width: 200px;
            display: flex;
            align-items: center;
          "
        >
          <div>
            <div style="font-size: 30px">WELCOME</div>
            <div
              style="
                font-size: 16px;
                padding-bottom: 7px;
                max-width: 150px;
                overflow-wrap: normal;
              "
            >
              to disco jerry's snakey snake arena
            </div>
            <button
              title="spacebar"
              onclick="startGame()"
              style="
                height: 30px;
                width: 100px;
                border-color: #584963;
                border-radius: 30px;
                box-shadow: none;
                color: white;
                background-color: #5a3973;
                margin-bottom: 10px;
                cursor: pointer;
              "
            >
              START</button
            ><br />
            <input
              style="cursor: pointer"
              id="discoToggle"
              checked
              onclick="toggleDisco()"
              type="checkbox"
            />
            Disco Mode
          </div>
        </div>
      </div>
    </div>
    <div id="end-screen-overlay" style="visibility: hidden; color: black">
      <div
        style="
          width: 100%;
          height: 100%;
          position: absolute;
          background-color: black;
          opacity: 80%;
          display: block;
          top: 0;
          left: 0;
          z-index: 100000000;
          align-items: center;
        "
      ></div>
      <div
        style="
          background-color: white;
          z-index: 100000001;
          position: absolute;
          top: 15%;
          border-radius: 90px;
          display: flex;
          padding: 5px;
          left: 0;
          right: 0;
          margin-inline: auto;
          width: fit-content;
        "
      >
        <img
          id="highScore"
          src="new_high_score.png"
          style="border-radius: 90px; display: flex; height: 0; width: 0"
        />
        <img
          id="gameOver"
          src="game_over.png"
          style="
            width: 300px;
            height: 300px;
            border-radius: 90px;
            display: flex;
          "
        />
        <div
          style="
            justify-content: center;
            min-width: 200px;
            display: flex;
            align-items: center;
          "
        >
          <div>
            <div id="finalScore" style="font-size: 50px"></div>
            <button
              title="spacebar"
              onclick="startGame()"
              style="
                cursor: pointer;
                height: 30px;
                width: 150px;
                border-color: #584963;
                border-radius: 30px;
                box-shadow: none;
                color: white;
                background-color: #5a3973;
                margin-bottom: 10px;
              "
            >
              START AGAIN</button
            ><br />
            <input
              style="cursor: pointer"
              id="discoToggle"
              checked
              onclick="toggleDisco()"
              type="checkbox"
            />
            Disco Mode
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    discoMode = true;
    newHighScore = false;
    score = 0;
    best = 0;
    arenaWidth = 75;
    arenaHeight = 40;
    setArenaSize();

    centerX = ~~(arenaWidth / 2);
    centerY = ~~(arenaHeight / 2);
    snake = [
      [centerX, centerY - 1],
      [centerX, centerY],
      [centerX, centerY + 1],
    ];
    foodPosition = [];
    turnQueue = [];
    border = [];
    snakeObjects = [];

    gradientCount = 10;
    colors = makeColorSequence(gradientCount);
    currentColor = 0;
    direction = "u";
    growCount = 0;

    activeGame = false;
    moving = false;
    step = setInterval(function () {
      moveSnake();
    }, 75);

    board = document.getElementById("board");
    board.style.width = `${arenaWidth * blockSize}`;
    board.style.height = `${arenaHeight * blockSize}`;

    overlay = document.getElementById("start-screen-overlay");
    endOverlay = document.getElementById("end-screen-overlay");

    z = 3;

    function listIncludesPoint(pointsList, point) {
      for (var i = 0; i < pointsList.length; i++) {
        if (pointsList[i][0] == point[0] && pointsList[i][1] == point[1]) {
          return true;
        }
      }
      return false;
    }

    function drawSquare(color, position, isBorder) {
      square = document.createElement("div");
      board.appendChild(square);
      square.style.width = isBorder
        ? `${blockSize + borderSize * 2}`
        : `${blockSize}`;
      square.style.height = isBorder
        ? `${blockSize + borderSize * 2}`
        : `${blockSize}`;
      square.style.backgroundColor = color;
      square.style.display = "block";
      square.style.position = "absolute";
      square.style.top = isBorder
        ? `${position[1] * blockSize - borderSize}`
        : `${position[1] * blockSize}`;
      square.style.left = isBorder
        ? `${position[0] * blockSize - borderSize}`
        : `${position[0] * blockSize}`;
      square.style.zIndex = `${z}`;
      return square;
    }

    function moveSquare(id, position) {
      square = document.getElementById(id);
      console.log(square);
      console.log(id);
      square.style.width = `${blockSize}`;
      square.style.height = `${blockSize}`;
      square.style.visibility = "visible";
      square.style.top = `${position[1] * blockSize}`;
      square.style.left = `${position[0] * blockSize}`;
      square.style.zIndex = `${z}`;
      return square;
    }

    function setFood() {
      x = ~~(Math.random() * arenaWidth);
      y = ~~(Math.random() * arenaHeight);
      while (listIncludesPoint(snake, [x, y])) {
        x = ~~(Math.random() * arenaWidth);
        y = ~~(Math.random() * arenaHeight);
      }
      console.log(`Food set at ${x}, ${y}`);
      foodPosition = [x, y];
      moveSquare("food", foodPosition);
    }

    function drawWholeSnake() {
      for (var i = 0; i < snake.length; i++) {
        segmentBorder = drawSquare("white", snake[i], discoMode);
        border.push(segmentBorder);
      }
      if (discoMode) {
        for (var i = 0; i < snake.length; i++) {
          snakeSegment = drawSquare(colors[currentColor], snake[i], false);
          snakeObjects.push(snakeSegment);
        }
      }
      z++;
    }

    function makeColorSequence(gradientCount) {
      hues = [0, 30, 57, 100, 200, 270, 290];
      finalHues = [];
      darker = true;
      for (var i = 0; i < hues.length; i++) {
        for (var j = 1; j <= gradientCount; j++) {
          // 85 - 45
          if (darker) {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${85 - j * ~~(40 / gradientCount)}%)`
            );
          } else {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${45 + j * ~~(40 / gradientCount)}%)`
            );
          }
        }
        darker = !darker;
      }
      for (var i = 0; i < hues.length; i++) {
        for (var j = 1; j <= gradientCount; j++) {
          // 85 - 45
          if (darker) {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${85 - j * ~~(40 / gradientCount)}%)`
            );
          } else {
            finalHues.push(
              `hsl(${hues[i]}, 100%, ${45 + j * ~~(40 / gradientCount)}%)`
            );
          }
        }
        darker = !darker;
      }
      return finalHues;
    }

    function moveSnake() {
      if (!moving || !activeGame) {
        return;
      }
      if (turnQueue.length > 0) {
        changeDirection(turnQueue[turnQueue.length - 1]);
        turnQueue.pop();
      }
      switch (direction) {
        case "u":
          snake = [[snake[0][0], snake[0][1] - 1]].concat(snake);
          break;
        case "d":
          snake = [[snake[0][0], snake[0][1] + 1]].concat(snake);
          break;
        case "l":
          snake = [[snake[0][0] - 1, snake[0][1]]].concat(snake);
          break;
        case "r":
          snake = [[snake[0][0] + 1, snake[0][1]]].concat(snake);
          break;
      }

      // Check whether the snake got itself or hit a wall.
      if (
        listIncludesPoint(snake.slice(1), snake[0]) ||
        snake[0][0] < 0 ||
        snake[0][0] > arenaWidth - 1 ||
        snake[0][1] < 0 ||
        snake[0][1] > arenaHeight - 1
      ) {
        endScreen();
        return;
      }

      // Check whether the snake got the food
      if (snake[0][0] == foodPosition[0] && snake[0][1] == foodPosition[1]) {
        growCount += 3;
        score += 10;
        document.getElementById("score").innerText = score;
        if (score > best) {
          newHighScore = true;
          best = score;
          document.getElementById("best").innerText = best;
          document.getElementById("bestScore").style.display = "none";
          document.getElementById("bestBanner").style.display = "inline";
        }

        setFood();
      }
      border = [drawSquare("white", snake[0], discoMode)].concat(border);
      if (discoMode) {
        snakeObjects = [
          drawSquare(colors[currentColor], snake[0], false),
        ].concat(snakeObjects);
        currentColor++;
      }
      document.getElementById("b").style.color = colors[currentColor];
      document.getElementById("e").style.color = colors[currentColor - 2];
      document.getElementById("s").style.color = colors[currentColor - 4];
      document.getElementById("t").style.color = colors[currentColor - 6];
      // Delete the tail if not growing.1
      if (growCount > 0) {
        growCount--;
      } else {
        snake.pop();
        board.removeChild(border[border.length - 1]);
        border.pop();
        snakeObjects.pop();
      }
      for (var i = 0; i < border.length; i++) {
        border[i].style.zIndex = z;
      }
      z++;
      for (var i = 0; i < snakeObjects.length; i++) {
        snakeObjects[i].style.zIndex = z;
        snakeObjects[i].style.backgroundColor = colors[currentColor];
      }
      currentColor++;
      if (currentColor >= colors.length) {
        currentColor = 0;
      }
      z++;
    }

    document.addEventListener("keydown", queueTurn);

    function queueTurn(e) {
      if (e.code == "Space") {
        e.preventDefault();
        if (!activeGame) {
          startGame();
          return;
        }
        moving = !moving;
      }
      if (!moving) {
        return;
      }
      if (
        e.code == "ArrowUp" ||
        e.code == "ArrowDown" ||
        e.code == "ArrowLeft" ||
        e.code == "ArrowRight"
      ) {
        e.preventDefault();
        turnQueue = [e.code].concat(turnQueue);
      }
    }

    function changeDirection(code) {
      switch (code) {
        case "ArrowUp":
          if (direction != "d") {
            direction = "u";
          }
          break;
        case "ArrowDown":
          if (direction != "u") {
            direction = "d";
          }
          break;
        case "ArrowLeft":
          if (direction != "r") {
            direction = "l";
          }
          break;
        case "ArrowRight":
          if (direction != "l") {
            direction = "r";
          }
          break;
      }
    }

    function startGame() {
      setArenaSize();
      newHighScore = false;
      score = 0;
      document.getElementById("score").innerText = score;
      overlay.style.visibility = "hidden";
      endOverlay.style.visibility = "hidden";
      document.getElementById("bestScore").style.display = "inline";
      document.getElementById("bestBanner").style.display = "none";
      foodPosition = [];
      z = 10;
      turnQueue = [];
      border = [];
      snakeObjects = [];
      board.innerHTML = "";
      snake = [
        [centerX, centerY - 1],
        [centerX, centerY],
        [centerX, centerY + 1],
      ];

      drawWholeSnake();
      direction = "u";
      growCount = 0;
      moving = true;
      activeGame = true;
      drawSquare("black", [0, 0], false).id = "food";
      setFood();
    }

    function setArenaSize() {
      blockSize = Math.floor(
        Math.min(
          (window.innerWidth - 20) / arenaWidth,
          (window.innerHeight - 20) / arenaHeight
        )
      );
      borderSize = Math.max(Math.floor(blockSize / 4), 1);
      board.style.width = `${arenaWidth * blockSize}`;
      board.style.height = `${arenaHeight * blockSize}`;
    }

    function endScreen() {
      document.getElementById("finalScore").innerText = `${score}`;
      if (newHighScore) {
        document.getElementById("highScore").style.width = "300px";
        document.getElementById("highScore").style.height = "300px";
        document.getElementById("gameOver").style.width = "0px";
        document.getElementById("gameOver").style.width = "0px";
      } else {
        document.getElementById("highScore").style.width = "0px";
        document.getElementById("highScore").style.height = "0px";
        document.getElementById("gameOver").style.width = "300px";
        document.getElementById("gameOver").style.height = "300px";
      }
      endOverlay.style.visibility = "visible";
      moving = false;
      activeGame = false;
    }

    function toggleDisco() {
      discoMode = !discoMode;
      document.getElementById("discoToggle").checked = discoMode;
      discoSlug = document.getElementById("discoSlug");
      discoSlug.style.width = discoMode ? "300px" : "0px";
      discoSlug.style.height = discoMode ? "300px" : "0px";
      sadSlug = document.getElementById("sadSlug");
      sadSlug.style.width = discoMode ? "0px" : "300px";
      sadSlug.style.height = discoMode ? "0px" : "300px";
    }
  </script>
</html>
